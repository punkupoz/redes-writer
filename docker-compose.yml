# example docker-compose, just for testing
# ---------------------
version: '2.1'
services:
  redis:
    image: "redis:5.0-alpine"
    healthcheck:
      test: ["CMD", "redis-cli","ping"]
      interval: 30s
      timeout: 10s
      retries: 3
  elasticsearch:
    image: "docker.elastic.co/elasticsearch/elasticsearch:7.3.0"
    environment:
      - discovery.type=single-node
    healthcheck:
      test: ["CMD-SHELL", "curl --silent --fail localhost:9200/_cluster/health || exit 1"]
      interval: 30s
      timeout: 30s
      retries: 3
  writer:
    image: "andytruong/redes-writer:7.x"
#    build: "."
    volumes:
      - "./config.sample.yaml:/config.yaml"
    entrypoint: ["/app", "-c", "/config.yaml"]
    depends_on:
      redis: { condition: service_healthy }
      elasticsearch: { condition: service_healthy }
#    healthcheck:
#      test: ["CMD-SHELL", "wget localhost:8484/metrics -q -O - > /dev/null 2>&1"]
#      interval: 30s
#      timeout: 30s
#      retries: 3
#  prometheus:
#    image: "prom/prometheus:v2.12.0"
#    ports:
#      - "9090:9090"
#    volumes:
#      - "./metrics.configs.sample/prometheus/prometheus.sample.yml:/etc/prometheus/prometheus.yml"
#    depends_on:
#      writer: { condition: service_healthy }
##      - writer
#    healthcheck:
#      test: ["CMD-SHELL", "wget localhost:9090/-/healthy -q -O - > /dev/null 2>&1"]
#      interval: 30s
#      timeout: 30s
#      retries: 3
